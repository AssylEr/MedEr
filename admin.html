<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager (Sveltia CMS)</title>
  <script src="https://cdn.jsdelivr.net/npm/sveltia-cms@2.2.0/dist/sveltia-cms.js"></script>
  <script type="importmap">
  {
    "imports": {
      "vite": "https://aistudiocdn.com/vite@^7.1.12",
      "url": "https://aistudiocdn.com/url@^0.11.4"
    }
  }
  </script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f9f9f9; }
    #app { display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
    .spinner { border: 4px solid rgba(0,0,0,0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #09f; animation: spin 1s ease infinite; margin: 0 auto 20px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loader-text { font-size: 1.2em; color: #555; }
    .error-container { padding: 40px; color: #333; max-width: 800px; margin: auto; }
    .error-container h1 { color: #d9534f; }
    .error-container p { color: #555; margin-bottom: 20px; font-size: 1.1em; }
    .error-box { background: #fff; border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: left; background: #ffebeb; }
    .error-box h3 { border-bottom: 1px solid #d9534f; color: #d9534f; padding-bottom: 10px; margin-top:0; }
    .error-box pre { background: #f5f5f5; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; color: #333; font-family: monospace; }
  </style>
</head>
<body>
  <!-- The Sveltia CMS app will be mounted here -->
  <div id="app"></div>

  <script>
    const appContainer = document.getElementById('app');

    const showLoader = () => {
      appContainer.innerHTML = `
        <div>
          <div class="spinner"></div>
          <p class="loader-text">Initializing Content Manager...</p>
        </div>
      `;
    };

    const showError = (title, message, error) => {
      let errorDetails = '';
      if (error) {
        errorDetails = `
          <div class="error-box">
            <h3>Technical Details</h3>
            <pre>${error.stack || error.toString()}</pre>
          </div>
        `;
      }
      appContainer.innerHTML = `
        <div class="error-container">
          <h1>${title}</h1>
          <p>${message}</p>
          ${errorDetails}
        </div>
      `;
    };

    const config = {
      // Sveltia CMS configuration
      backend: {
        name: 'github',
        repo: 'AssylEr/MedEr', // This should be your repository
        branch: 'main',
        auth_type: 'pkce',
        app_id: 'Ov23liXxs76aN3z4skEo', // This should be your GitHub OAuth App Client ID
      },
      publish_mode: 'simple',
      media_folder: 'uploads',
      public_folder: '/uploads',
      collections: [
        {
          name: 'pages',
          label: 'Pages & Content',
          files: [
            {
              name: 'home',
              label: 'Home Page',
              file: 'home.json',
              fields: [
                { label: 'English Content', name: 'en', widget: 'object', fields: [
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'text' },
                ]},
                { label: 'Arabic Content', name: 'ar', widget: 'object', fields: [
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'text' },
                ]},
              ],
            },
            {
              name: 'about',
              label: 'About Us Page',
              file: 'about.json',
              fields: [
                { label: 'English Content', name: 'en', widget: 'object', fields: [
                    { label: 'Page Title', name: 'page_title', widget: 'string' },
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                    { label: 'Admin Section Title', name: 'admin_title', widget: 'string' },
                    { label: 'Admin Section Description', name: 'admin_desc', widget: 'text' },
                    { label: 'Contact Section Title', name: 'contact_title', widget: 'string' },
                    { label: 'Contact Admin Line', name: 'contact_admin', widget: 'string' },
                    { label: 'Contact Email Line', name: 'contact_email', widget: 'string' },
                ]},
                { label: 'Arabic Content', name: 'ar', widget: 'object', fields: [
                    { label: 'Page Title', name: 'page_title', widget: 'string' },
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                    { label: 'Admin Section Title', name: 'admin_title', widget: 'string' },
                    { label: 'Admin Section Description', name: 'admin_desc', widget: 'text' },
                    { label: 'Contact Section Title', name: 'contact_title', widget: 'string' },
                    { label: 'Contact Admin Line', name: 'contact_admin', widget: 'string' },
                    { label: 'Contact Email Line', name: 'contact_email', widget: 'string' },
                ]},
              ],
            },
            {
              name: 'privacy',
              label: 'Website Privacy Page',
              file: 'privacy.json',
              fields: [
                { label: 'English Content', name: 'en', widget: 'object', fields: [
                    { label: 'Page Title', name: 'page_title', widget: 'string' },
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                    { label: 'Introduction Title', name: 'intro_title', widget: 'string' },
                    { label: 'Introduction Content', name: 'intro_p1', widget: 'text' },
                    { label: 'Data Collection Title', name: 'data_collection_title', widget: 'string' },
                    { label: 'Data Collection Content', name: 'data_collection_p1', widget: 'text' },
                    { label: 'Types of Data Title', name: 'data_type_title', widget: 'string' },
                    { label: 'Types of Data List (Markdown)', name: 'data_type_list', widget: 'markdown' },
                    { label: 'Personal Info Title', name: 'data_personal_title', widget: 'string' },
                    { label: 'Personal Info Content', name: 'data_personal_p1', widget: 'text' },
                    { label: 'How We Use Title', name: 'data_use_title', widget: 'string' },
                    { label: 'How We Use Content', name: 'data_use_p1', widget: 'text' },
                    { label: 'How We Use List (Markdown)', name: 'data_use_list', widget: 'markdown' },
                    { label: 'Sharing Title', name: 'data_sharing_title', widget: 'string' },
                    { label: 'Sharing Content', name: 'data_sharing_p1', widget: 'text' },
                    { label: 'Links Title', name: 'links_title', widget: 'string' },
                    { label: 'Links Content', name: 'links_p1', widget: 'text' },
                    { label: 'Security Title', name: 'security_title', widget: 'string' },
                    { label: 'Security Content', name: 'security_p1', widget: 'text' },
                    { label: 'Contact Title', name: 'contact_title', widget: 'string' },
                    { label: 'Contact Content', name: 'contact_p1', widget: 'string' },
                ]},
                { label: 'Arabic Content', name: 'ar', widget: 'object', fields: [
                    { label: 'Page Title', name: 'page_title', widget: 'string' },
                    { label: 'Header Title', name: 'header_title', widget: 'string' },
                    { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                    { label: 'Introduction Title', name: 'intro_title', widget: 'string' },
                    { label: 'Introduction Content', name: 'intro_p1', widget: 'text' },
                    { label: 'Data Collection Title', name: 'data_collection_title', widget: 'string' },
                    { label: 'Data Collection Content', name: 'data_collection_p1', widget: 'text' },
                    { label: 'Types of Data Title', name: 'data_type_title', widget: 'string' },
                    { label: 'Types of Data List (Markdown)', name: 'data_type_list', widget: 'markdown' },
                    { label: 'Personal Info Title', name: 'data_personal_title', widget: 'string' },
                    { label: 'Personal Info Content', name: 'data_personal_p1', widget: 'text' },
                    { label: 'How We Use Title', name: 'data_use_title', widget: 'string' },
                    { label: 'How We Use Content', name: 'data_use_p1', widget: 'text' },
                    { label: 'How We Use List (Markdown)', name: 'data_use_list', widget: 'markdown' },
                    { label: 'Sharing Title', name: 'data_sharing_title', widget: 'string' },
                    { label: 'Sharing Content', name: 'data_sharing_p1', widget: 'text' },
                    { label: 'Links Title', name: 'links_title', widget: 'string' },
                    { label: 'Links Content', name: 'links_p1', widget: 'text' },
                    { label: 'Security Title', name: 'security_title', widget: 'string' },
                    { label: 'Security Content', name: 'security_p1', widget: 'text' },
                    { label: 'Contact Title', name: 'contact_title', widget: 'string' },
                    { label: 'Contact Content', name: 'contact_p1', widget: 'string' },
                ]},
              ],
            },
            {
              name: 'apps',
              label: 'Applications',
              file: 'apps.json',
              editor: { preview: false },
              fields: [
                {
                  name: 'applications', label: 'Applications', label_singular: 'Application', widget: 'list',
                  fields: [
                    { label: 'Slug', name: 'slug', widget: 'string' },
                    { label: 'Is Placeholder', name: 'is_placeholder', widget: 'boolean', default: false },
                    { label: 'App Page Link', name: 'href', widget: 'string' },
                    { label: 'Thumbnail Image', name: 'imgSrc', widget: 'image' },
                    { label: 'Image Alt Text', name: 'alt', widget: 'string' },
                    { label: 'English Content', name: 'en', widget: 'object', fields: [
                        { label: 'App Name', name: 'name', widget: 'string' },
                        { label: 'Short Description', name: 'short_desc', widget: 'text' },
                        { label: 'Page Title', name: 'page_title', widget: 'string' },
                        { label: 'Header Title', name: 'header_title', widget: 'string' },
                        { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                        { label: 'Intro Section Title', name: 'intro_title', widget: 'string' },
                        { label: 'Intro Section Description', name: 'intro_desc', widget: 'markdown' },
                        { label: 'Features Section Title', name: 'features_title', widget: 'string' },
                        { label: 'Features Section Description', name: 'features_desc', widget: 'markdown' },
                        { label: 'Features List', name: 'features_list', widget: 'list', fields: [{ label: 'Feature Item (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Gallery Section Title', name: 'gallery_title', widget: 'string' },
                        { label: 'Gallery Section Description', name: 'gallery_desc', widget: 'markdown' },
                        { label: 'How-To Section Title', name: 'howto_title', widget: 'string' },
                        { label: 'How-To Section Description', name: 'howto_desc', widget: 'markdown' },
                        { label: 'How-To Steps', name: 'howto_steps', widget: 'list', fields: [{ label: 'Step (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Privacy Section Title', name: 'privacy_title', widget: 'string' },
                        { label: 'Privacy Section Description', name: 'privacy_desc', widget: 'markdown' },
                        { label: 'Privacy Points', name: 'privacy_points', widget: 'list', fields: [{ label: 'Point (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Privacy Summary', name: 'privacy_summary', widget: 'string' },
                        { label: 'Privacy Button Text', name: 'privacy_btn_text', widget: 'string' },
                        { label: 'Footer Title', name: 'footer_title', widget: 'string' },
                        { label: 'Footer Description', name: 'footer_desc', widget: 'string' },
                        { label: 'Download Button Text', name: 'download_btn_text', widget: 'string' },
                        { label: 'Privacy Policy Page Title', name: 'privacy_page_title', widget: 'string' },
                        { label: 'Privacy Policy Header Title', name: 'privacy_header_title', widget: 'string' },
                        { label: 'Privacy Policy Header Subtitle', name: 'privacy_header_subtitle', widget: 'string' },
                        { label: 'Privacy Policy Content', name: 'privacy_content', widget: 'markdown' },
                    ]},
                    { label: 'Arabic Content', name: 'ar', widget: 'object', fields: [
                        { label: 'App Name', name: 'name', widget: 'string' },
                        { label: 'Short Description', name: 'short_desc', widget: 'text' },
                        { label: 'Page Title', name: 'page_title', widget: 'string' },
                        { label: 'Header Title', name: 'header_title', widget: 'string' },
                        { label: 'Header Subtitle', name: 'header_subtitle', widget: 'string' },
                        { label: 'Intro Section Title', name: 'intro_title', widget: 'string' },
                        { label: 'Intro Section Description', name: 'intro_desc', widget: 'markdown' },
                        { label: 'Features Section Title', name: 'features_title', widget: 'string' },
                        { label: 'Features Section Description', name: 'features_desc', widget: 'markdown' },
                        { label: 'Features List', name: 'features_list', widget: 'list', fields: [{ label: 'Feature Item (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Gallery Section Title', name: 'gallery_title', widget: 'string' },
                        { label: 'Gallery Section Description', name: 'gallery_desc', widget: 'markdown' },
                        { label: 'How-To Section Title', name: 'howto_title', widget: 'string' },
                        { label: 'How-To Section Description', name: 'howto_desc', widget: 'markdown' },
                        { label: 'How-To Steps', name: 'howto_steps', widget: 'list', fields: [{ label: 'Step (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Privacy Section Title', name: 'privacy_title', widget: 'string' },
                        { label: 'Privacy Section Description', name: 'privacy_desc', widget: 'markdown' },
                        { label: 'Privacy Points', name: 'privacy_points', widget: 'list', fields: [{ label: 'Point (HTML allowed)', name: 'item', widget: 'string' }] },
                        { label: 'Privacy Summary', name: 'privacy_summary', widget: 'string' },
                        { label: 'Privacy Button Text', name: 'privacy_btn_text', widget: 'string' },
                        { label: 'Footer Title', name: 'footer_title', widget: 'string' },
                        { label: 'Footer Description', name: 'footer_desc', widget: 'string' },
                        { label: 'Download Button Text', name: 'download_btn_text', widget: 'string' },
                        { label: 'Privacy Policy Page Title', name: 'privacy_page_title', widget: 'string' },
                        { label: 'Privacy Policy Header Title', name: 'privacy_header_title', widget: 'string' },
                        { label: 'Privacy Policy Header Subtitle', name: 'privacy_header_subtitle', widget: 'string' },
                        { label: 'Privacy Policy Content', name: 'privacy_content', widget: 'markdown' },
                    ]},
                    { label: 'Screenshot Gallery Images', name: 'screenshots', widget: 'list', fields: [{ label: 'Image', name: 'src', widget: 'image' }] },
                    { label: 'Google Play Store Link', name: 'play_store_link', widget: 'string', required: false },
                  ],
                },
              ],
            },
          ],
        },
      ],
    };

    const init = () => {
      // We start by showing a loader in the #app container.
      showLoader();
      
      // Give the SveltiaCMS script a moment to load from the CDN.
      setTimeout(() => {
        if (typeof SveltiaCMS === 'undefined') {
          showError(
            'CMS Script Failed to Load',
            'The Content Manager script could not be loaded from the CDN. Please check your network connection and ensure that content from cdn.jsdelivr.net is not being blocked.',
            new Error('`SveltiaCMS` is not defined on the window object.')
          );
          return;
        }

        try {
          // Pass the #app container for Sveltia CMS to mount into.
          SveltiaCMS.init({ el: '#app', config });
        } catch (e) {
          console.error("Sveltia CMS initialization error:", e);
          showError(
            'CMS Initialization Failed',
            'The Content Manager encountered a critical error during startup. This might be due to a malformed configuration or a bug in the CMS itself.',
            e
          );
        }
      }, 500);
    };

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>